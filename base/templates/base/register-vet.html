{% extends 'main.html' %}

{% block content %}
<main class="auth layout">
  <div class="container">

    <div class="layout__box__1">
      <div class="layout__boxHeader">
        <div class="layout__boxTitle">
          <h3>Register Vet</h3>
        </div>
      </div>

      <div class="layout__body">
        <h2 class="auth__tagline">Find your veterinarian</h2>

        <form action="" method="POST" enctype="multipart/form-data">
          {% csrf_token %}

          <!-- Personal Info -->
          <div class="form_group_wrapper">
            <h3 class="form_group_header auth__tagline">Personal Info</h3>
            {% for field in form1 %}
            <div class="form__group">
              <label>{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
                    <ul class="errorlist">{{ field.errors }}</ul>
                  {% endif %}
            </div>
            {% endfor %}
          </div>

          <!-- Vet Profile -->
          <div class="form_group_wrapper">
            <h3 class="form_group_header auth__tagline">Vet Profile</h3>
            {% for field in form2 %}
            <div class="form__group">
              <label>{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
                <ul class="errorlist">{{ field.errors }}</ul>
              {% endif %}
            </div>
            {% endfor %}
          </div>

          <!-- Education Formset -->
          <div class="form_group_wrapper">
            <h3 class="form_group_header auth__tagline">Educational Background</h3>
            {{ form3.management_form }}
            <div id="education-forms" class="flex-formset">
              {% for form in form3 %}
              <div class="formset-item">
                {% for field in form %}
                <div class="form__group">
                  <label>{{ field.label }}</label>
                  {{ field }}
                  {% if field.errors %}
                    <ul class="errorlist">{{ field.errors }}</ul>
                  {% endif %}
                </div>
                {% endfor %}
                <button type="button" class="btn btn--danger remove-form">Remove</button>
              </div>
              {% endfor %}
            </div>
            <button type="button" id="add-education" class="btn btn--secondary">Add Education</button>
          </div>

          <!-- Portfolio Formset -->
          <!-- <div class="form_group_wrapper">
            <h3 class="form_group_header auth__tagline">Portfolio</h3>
            {{ form4.management_form }}
            <div id="portfolio-forms" class="flex-formset">
              {% for form in form4 %}
              <div class="formset-item">
                {% for field in form %}
                <div class="form__group">
                  <label for = "{{ field.id_for_label }}">{{ field.label }}</label>
                  {{ field }}
                  {% if field.errors %}
                    <ul class="errorlist">{{ field.errors }}</ul>
                  {% endif %}
                </div>
                {% endfor %}
                <button type="button" class="btn btn--danger remove-form">Remove</button>
              </div>
              {% endfor %}
            </div>
            <button type="button" id="add-portfolio" class="btn btn--secondary">Add Portfolio</button>
          </div> -->

          <!-- Submit -->
          <button class="btn btn--main" type="submit">Submit</button>
        </form>

      </div>
    </div>
  </div>
</main>

<!-- JS for dynamic formsets -->
<script>
function setupFormset(containerId, addBtnId) {
    const container = document.getElementById(containerId);
    const addButton = document.getElementById(addBtnId);

    addButton.addEventListener('click', () => {
        const totalFormsInput = container.closest('form').querySelector('[name$="-TOTAL_FORMS"]');
        let total = parseInt(totalFormsInput.value);

        const firstForm = container.querySelector('.formset-item');
        const newForm = firstForm.cloneNode(true);

        // Clear inputs
        newForm.querySelectorAll('input, select, textarea').forEach(input => input.value = '');

        // Update indices
        newForm.innerHTML = newForm.innerHTML.replace(/-\d+-/g, `-${total}-`);

        container.appendChild(newForm);

        // Increment TOTAL_FORMS
        totalFormsInput.value = total + 1;

        // Remove listener
        newForm.querySelector('.remove-form').addEventListener('click', () => {
            newForm.remove();
            totalFormsInput.value = parseInt(totalFormsInput.value) - 1;
        });
    });

    // Existing remove buttons
    container.querySelectorAll('.remove-form').forEach(btn => {
        btn.addEventListener('click', () => {
            btn.closest('.formset-item').remove();
            const totalFormsInput = container.closest('form').querySelector('[name$="-TOTAL_FORMS"]');
            totalFormsInput.value = parseInt(totalFormsInput.value) - 1;
        });
    });
}

setupFormset('education-forms', 'add-education');
setupFormset('portfolio-forms', 'add-portfolio');
</script>

{% endblock content %}
